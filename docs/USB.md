# USB

## 电气特性

1. 5V电源线（$V_{BUS}$、GND）、3.3V差分数据线($D_+$、$D_-$)

2. 低速和全速:电压传输,高速:电流传输

## 链路传输

1. 编码方式:NRZI

   Non-Return-to-Zero, Inverted, 翻译成中文是‘翻转不归零码’‘

   不归零的意思是编码方式相对于归零码(正电平，负电平，0电平)而言，还是只有两种电平，不用每次编码完都回到0电平。

   翻转是指当出现逻辑0时，电平翻转，因此不需要负电平来表示0

2. DCR/DC balence:bit stuffing

   每6个连续的1之后，会强制插入一个0，使得发送信号强制出现翻转，接收方在收到翻转信号时可以调整频率，从而实现时钟同步

## 协议
> |      | USB1    | USB2.0  | USB3.0/USB 3.1 Gen 1 | USB 3.1 Gen 2 |
> | ---- | ------- | ------- | -------------------- | ------------- |
> | 低速 | 1.5Mb/s | 1.5Mb/s |                      |               |
> | 全速 | 12Mb/s  | 12Mb/s  |                      |               |
> | 高速 | /       | 480Mb/s | 5Gb/s                | 20Gb/s        |


## 驱动
> 1. USB 底层驱动程序： USB 底层驱动程序由操作系统提供，它位于 USB 功能驱动程序的下面，负责与实际的硬件打交道，实现繁 琐的底层通信。
>
> 2. USB 功能驱动程序： USB 功能驱动程序由设备开发者编写，位于 USB 底层驱动程序的上面，不与实际的硬件打交道，而是通过 向 USB 底层驱动程序发送包含 URB(USB Request Block ， USB 请求块 ) 的 IRP(I/O Request Packet ， I/O 请求包 ) ，来实现对 USB 设备信息的发送和接收。
>
>   若应用程序想对设备进行 I/O 操作，它需调用 Windows API 函数 ，I/O 管理器将此请求构造成一个合适的 I/O 请求包 IRP 并把它传递给 USB 功能驱动程序。USB 功能驱动程序接收到这个 IRP 以后，根据 IRP 中包含的具体操作代码，构造相应 USB 请求块并把此 URB 放到一个新的 IRP 中，然后把此 IRP 传递 USB 底层驱动程序，USB底层驱动程序根据 IRP 中所含的 URB 执行响应的操作(如从 USB 设备读取数据)，并把操作结果返还给 USB 功能驱动程序。USB 功能驱动程序接收到此 IRP 后，将操作结果通过 IRP 返还给 I/O 管理器，最后 I/O 管理器将此 IRP 操作结果返还给应用程序，至此应用程序对 USB 设备的一次 I/O 操作完成。
>
>    ————————————————
> 
> 版权声明：本文为CSDN博主「mannhello」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
> 
> 原文链接：https://blog.csdn.net/mannhello/article/details/4510759
